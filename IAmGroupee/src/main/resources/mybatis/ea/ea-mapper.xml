<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="ea">
	<!-- 기본설정 데이터 -->
	<select id="defaultSettings" resultType="com.kh.iag.ea.entity.SettingsDto">
		SELECT A.SEC_MIN SECMINA,
				B.SEC_MIN SECMINB,
				F.FORMAT_YEAR,
				F.FORMAT_DEPT,
				F.FORMAT_FORM
		FROM EA_SEC_A A, EA_SEC_B B, EA_FORMAT F
	</select>
	<!-- 직위 데이터 -->
	<select id="positionValues" resultType="com.kh.iag.ea.entity.PositionDto">
		SELECT * FROM POSITION ORDER BY POSITION_LEVEL
	</select>
	
	<!-- 문서 설정 업데이트 -->
	<update id="updateSettings1" parameterType="com.kh.iag.ea.entity.SettingsDto">
		UPDATE EA_SEC_A SET SEC_MIN = ${secMinA} WHERE SEC_GRADE = 'A'
	</update>
	<update id="updateSettings2" parameterType="com.kh.iag.ea.entity.SettingsDto">
		UPDATE EA_SEC_B SET SEC_MIN = ${secMinB} WHERE SEC_GRADE = 'B'
	</update>
	<update id="updateSettings3" parameterType="com.kh.iag.ea.entity.SettingsDto">
		UPDATE EA_FORMAT SET FORMAT_YEAR = #{formatYear}, FORMAT_DEPT = #{formatDept}, FORMAT_FORM = #{formatForm} WHERE FORMAT_NO = 1
	</update>
	
	<!--카테고리 데이터 -->
	<select id="categoryValues" resultType="com.kh.iag.ea.entity.CategoryDto">
		SELECT * FROM EA_CATEGORY ORDER BY CATEGORY_NO
	</select>
	
	<!-- 양식 데이터 -->
	<select id="formValues" resultType="eaform">
		SELECT * 
		FROM EA_FORM F 
		JOIN EA_CATEGORY C ON(F.CATEGORY_NO = C.CATEGORY_NO)
	</select>
	
	<!-- 양식관리 카테고리 추가 -->
	<insert id="insertFormCategory">
		INSERT INTO EA_CATEGORY
		(CATEGORY_NO, CATEGORY_NAME)
		VALUES
		(SEQ_EA_CATEGORY_NO.NEXTVAL, '새로운 카테고리')
	</insert>
	
	<!-- 새로 추가한 카테고리 정보 가져오기 -->
	<select id="selectLatestFormCategory" resultType="com.kh.iag.ea.entity.CategoryDto">
		SELECT * FROM (SELECT ROWNUM AS RNUM, c.* FROM (SELECT * FROM EA_CATEGORY ORDER BY CATEGORY_NO DESC) c) WHERE RNUM = 1
	</select>
	
	<!-- 카테고리 삭제 -->
	<delete id="deleteFormCategory" parameterType="string">
		DELETE FROM EA_CATEGORY WHERE CATEGORY_NO = ${categoryNo}
	</delete>
	
	<!-- 양식관리 양식 추가  -->
	<insert id="insertForm" parameterType="string">
		INSERT INTO EA_FORM 
		(
			FORM_NO
			, FORM_TITLE
			, FORM_CONTENT
			, FORM_YEARS
			, CATEGORY_NO
		)
		VALUES 
		(
			SEQ_EA_FORM_NO.NEXTVAL
			, '새로운 양식'
			, '&lt;h1 style="text-align:center"&gt;새로운 양식&lt;/h1&gt;'
			, 1
			, ${categoryNo}
		)
	</insert>
	
	<!-- 새로 추가한 양식 정보 가져오기 -->
	<select id="selecLatestForm" resultType="eaform" >
		SELECT * FROM (SELECT ROWNUM AS RNUM, f.* FROM (SELECT * FROM EA_FORM ORDER BY FORM_NO DESC) f) WHERE RNUM = 1
	</select>
	
	<!-- 양식 삭제 -->
	<delete id="deleteForm" parameterType="string">
		DELETE FROM EA_FORM WHERE FORM_NO = ${formNo}
	</delete>
</mapper>